---
layout: post
title:  "A common Angle renderer for UWP and Win32 clients using Windows.UI.Composition"
date: 2020-02-20 19:51:02 -0800
categories: [angle]
tags: [c++]
---

For reasons that I'll cover in a future post, I've been experimenting with [LibAngle](https://chromium.googlesource.com/angle/angle) of late.  Angle, otherwise known as Almost Native Graphics Layer, is a translation layer that emulates OpenGL calls on top of various graphics backends such as DirectX, Vulcan etc.  From the repo description:

> The goal of ANGLE is to allow users of multiple operating systems to seamlessly run WebGL and other OpenGL ES content by translating OpenGL ES API calls to one of the hardware-supported APIs available for that platform. ANGLE currently provides translation from OpenGL ES 2.0, 3.0 and 3.1 to Vulkan, desktop OpenGL, OpenGL ES, Direct3D 9, and Direct3D 11. Future plans include ES 3.2, translation to Metal and MacOS, Chrome OS, and Fuchsia support.

Microsoft is an official contributor and back in 2018, I submitted a patch to add Windows.UI.Composition support as a type of "nativewindow".  

[![Angle Patch](/static/img/angle-1-26-2020/gerrit.png)](https://chromium-review.googlesource.com/c/angle/angle/+/1236844)

I was keen to do this upstream as the Microsoft fork has got pretty stale at this point.  The reasoning for this change is explained in more detail in the [writeup I did supporing the patch](https://docs.google.com/document/d/1ggv6H-aK1a3pXNMTtMF6h0Bv0rulIeBpBxBBCJYR6Zs/edit) but can be summarized as follows: an increasing number of WinRT API's work in both Win32 full trust as well as AppContainer partial trust environments.  The benefit to developers is they can reuse the same code in either WIN32 or UWP contexts.  This will become more seemless over time as we realize the [vision of unification](https://myignite.techcommunity.microsoft.com/sessions/81330?source=sessions) but can still be very beneficial in todays world.  By enabling Windows.UI.Composition.SpriteVisual to be used as a hosting mechanism, it would be possible to build a renderer using OpenGL and have this work everywhere: native win32 HWNDs, win32 XAML islands and UWP.

### Completing the work
Here is the branch with the final changes

### The Test Project
Here is the test project

### Win32 Desktop no XAML

### UWP XBOX

### UWP Windows 10X

### Win32 Desktop Xaml Islands

![angie in islands](/static/img/angle-1-26-2020/angleinislands.png)